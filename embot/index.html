<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<h1></h1>
<label>manual control<input type="checkbox"></label>
<script src="/socket.io/socket.io.js"></script>
<script>
    var msgs = ['EmBot is in auto mode', 'You are controlling EmBot now!'];
    document.addEventListener("DOMContentLoaded", function (event) {
        var manual = false;
        var socket = io.connect();
        socket.on('connect', function () {
            console.log('connected');
        });
        var $input = document.querySelector('input');
        var $h1 = document.querySelector('h1');
        $h1.innerText = msgs[0];
        $input.addEventListener('change', function () {
            manual = this.checked;
            socket.emit('ctrl-change', manual);
            if (this.checked) {
                $h1.innerText = msgs[1];
                sendData();
            } else {
                $h1.innerText = msgs[0];
            }
        });

        var map = {
            37: 'left',
            38: 'up',
            39: 'right',
            40: 'down'
        };
        var keysPressed = {
            left: false,
            up: false,
            right: false,
            down: false
        };



        document.addEventListener('keydown', function (e) {
            if(map[e.which]){
                keysPressed[map[e.which]] = true;
                sendData();
            }
        });
        document.addEventListener('keyup', function (e) {
            if(map[e.which]){
                keysPressed[map[e.which]] = false;
                sendData();
            }
        });

        function sendData(){
            if (manual) {
                console.log(keysPressed);
                socket.emit('ctrl', keysPressed);
            }
        }
    });
</script>
</body>
</html>